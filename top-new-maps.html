<!-- Modifications copyright (C) 2019 Kamil Szurant -->

<!DOCTYPE html>
<html lang = "en">

<head>
    <title>Beat Aim - Rhythm Shooter</title>
    <meta charset="UTF-8">
    <meta name="description"
        content="Beat Aim - rhythm game designed for FPS players with ai generated maps. Makes improving your aim incredibly fun while listening to your favorite songs.">
    <meta name="keywords" content="beat aim, beat,aim,beataim,shooter,trainer,practice,rhythm,3d,ai,kamyker">
    <meta name="author" content="Kamil Szurant">
    <meta property="og:title" content="Beat Aim">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://beataim.com/meta-image.jpg">
    <meta property="og:url" content="https://beataim.com">
    <meta property="og:description"
        content="Rhythm game designed for FPS players with ai generated maps. Makes improving your aim incredibly fun while listening to your favorite songs.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@beat_aim">
    <meta name="twitter:creator" content="@kamyker">
    <meta name="twitter:title" content="Beat Aim">
    <meta name="twitter:description"
        content="Rhythm game designed for FPS players with ai generated maps. Makes improving your aim incredibly fun while listening to your favorite songs.">
    <meta name="twitter:image" content="https://beataim.com/meta-image.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <!-- DEVELOPMENT FILES
  <link rel="stylesheet" type="text/css" href="../dist/css/meshki.min.css">
  <link rel="stylesheet" type="text/css" href="../dist/plugins/meshki-extra-button-colors.min.css">
  <script type="text/javascript" src="../dist/js/meshki.min.js"></script>
  DEVELOPMENT FILES -->
    <!-- PRODUCTION FILES -->
    <link rel="stylesheet" type="text/css" href="/cdn/meshki.min.css">
    <link rel="stylesheet" type="text/css" href="/cdn/meshki-extra-button-colors.min.css">
    <script type="text/javascript" src="/cdn/meshki.min.js"></script>
    <!-- PRODUCTION FILES -->
    <link rel="stylesheet" type="text/css" href="/custom.css">
    <link rel="stylesheet" type="text/css" href="/cdn/font-awesome.min.css">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="/cdn/prism.min.css">
    <link rel="stylesheet" href="/cdn/prism-okaidia.min.css">
    <link href="https://fonts.googleapis.com/css?family=Muli&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Cinzel&display=swap" rel="stylesheet">
    <link href="https://emoji-css.afeld.me/emoji.css" rel="stylesheet">
    <script type="text/javascript" src="/PlayFabClientApi.js"></script>
    <script type="text/javascript" src="/PlayFabCustom.js"></script>
    <script type="text/javascript" src="/AzAzAz.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/json2html/1.3.0/json2html.min.js"></script>
    <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
</head>

<body class="">

  <div class="sidenav push">
    <a href="javascript:void(0);" class="sidenav-close-button" onclick="meshki.closeSidenav()">&times;</a>
    <a href="index.html">Home</a>
    <div class="hide-on-mobile">
        <a href="https://discord.gg/2kW27Ez">Discord</a>
        <a href="https://twitter.com/beat_aim">Twitter</a>
        <a href="https://www.facebook.com/BeatAim/">Facebook</a>
    </div>
    <!-- <hr class="hide-on-non-mobile"> -->
    <div class="hide-on-non-mobile">
        <a href="https://store.steampowered.com/newshub/app/1142220" target="_blank"
            onclick="meshki.closeSidenav()">News</a>
        <a href="/roadmap" onclick="meshki.closeSidenav()">Roadmap</a>
        <a href="/esports" onclick="meshki.closeSidenav()">Esports League</a>
        <a href="/streamers" onclick="meshki.closeSidenav()">Streamers League</a>
        <a href="/top-new-maps" onclick="meshki.closeSidenav()">Mapping League</a>
        <a href="/partners" onclick="meshki.closeSidenav()">Partners</a>
        <!-- <a href="/referral">Referrals</a> -->
    </div>
    <hr>
    <!-- <button onclick="location.href='https://twitter.com/Meshki_UI'" class="button blue medium"><b></b><i class="fa fa-twitter" aria-hidden="true"></i></button>
  <button onclick="location.href='https://www.npmjs.com/package/meshki'" class="button red medium"><b>npm</b></button>
  <button onclick="location.href='https://github.com/Borderliner/Meshki'" class="button medium"><b></b><i class="fa fa-github" aria-hidden="true"></i></button> -->
    <a href="javascript:void(0)" disabled style="font-size: 1.5rem">Share on:</a>
    <div class="share-links">
        <a class="fb-share" href="https://www.facebook.com/sharer/sharer.php?u=http://beataim.com/" target="_blank"><i
                class="fa fa-facebook-square" aria-hidden="true"></i></a>
        <a class="tw-share" href="https://twitter.com/home?status=http://beataim.com/" target="_blank"><i
                class="fa fa-twitter-square" aria-hidden="true"></i></a>
        <a class="gp-share" href="https://plus.google.com/share?url=http://beataim.com/" target="_blank"><i
                class="fa fa-google-plus-square" aria-hidden="true"></i></a>
    </div>
</div>

  <div class="container">

    <div class="nav fixed">
    <ul>
        <li><a class="logo" href="javascript:void(0);" onclick="meshki.openSidenav()"><i class="fa fa-bars"
                    aria-hidden="true"></i>Beat Aim</a></li>
        <!-- <li class="nav-dropdown hide-on-mobile">
          <a href="javascript:void(0)" class="nav-dropdown-button">Plugins</a>
          <div class="nav-dropdown-content">
            <a href="rtl/">RTL Mode (Persian)</a>
            <a href="#extra-button-colors">Extra Button Colors</a>
          </div>
        </li> -->
        <div class="hide-on-mobile">
            <li><a href="https://store.steampowered.com/newshub/app/1142220" target="_blank">News</a></li>
            <li><a href="/roadmap">Roadmap</a></li>
            <!-- <li><a href="make-account.html">Alpha sign up</a></li> -->
            <li><a href="/esports">Esports League</a></li>
            <li><a href="/streamers">Streamers League</a></li>
            <li><a href="/top-new-maps">Mapping League</a></li>
            <!-- <li><a href="redeem-key.html">Redeem alpha key</a></li> -->
            <li><a href="/partners">Partners</a></li>
        </div>
        <!-- <li><a href="https://github.com/Borderliner/Meshki/blob/master/CHANGELOG.md">News</a></li>
        <li><a href="https://github.com/Borderliner/Meshki">GitHub</a></li> -->
        <!-- <li class="nav-dropdown hide-on-mobile">
          <a href="javascript:void(0)" class="nav-dropdown-button">Components</a>
          <div class="nav-dropdown-content">
            <a href="#buttons-doc">Buttons</a>
            <a href="#sidenav-doc">Sidenav</a>
            <a href="#navbar-doc">Navbar</a>
            <a href="#grid-doc">Grid System</a>
            <a href="#form-doc">Forms</a>
            <a href="#typography-doc">Typography</a>
            <a href="#tables-doc">Tables</a>
            <a href="#footer-doc">Footer</a>
          </div>
        </li> -->

        <li class="nav-right">
            <a href="https://store.steampowered.com/app/1142220/Beat_Aim__Rhythm_Aim_Trainer/" target="_blank"
                style="padding: 0px 10px">
                <img src="/imgs/steamearly.png" alt="BeatAimSteam" width="87px" height="34px">
            </a>
            <a href="https://discord.gg/2kW27Ez" target="_blank" style="padding: 0px 10px">
                <img src="/imgs/discord.png" alt="discord" width="38px" height="38px">
            </a>
            <a href="https://twitter.com/beat_aim" target="_blank" style="padding: 0px 10px">
                <img src="/imgs/twitter.png" alt="twitter" width="34px" height="34px">
            </a>
            <a href="https://www.facebook.com/BeatAim/" target="_blank" style="padding: 0px 10px">
                <img src="/imgs/fb.png" alt="facebook" width="34px" height="34px">
            </a>
        </li>

        <!-- <li class="nav-right hide-on-tablet">
          <script type="text/javascript" src="finder.js"></script>
          <input type="text" name="searchbox" id="searchbox" placeholder="Search..."
            onkeydown="meshkiUtil.search(this)">
        </li>
        <li class="nav-right hide-on-tablet"><button class="green" onclick="meshkiUtil.search(true)"><i
              class="fa fa-search" aria-hidden="true"></i></button></li> -->
    </ul>
</div>

    <div class="content">
<div class="row text-center">
    <h2>üó∫Ô∏è Mapping League üé≠</h2>
    <div id="timer"></div>
    <!-- <h3>Ends in:</h3>
    <h4 id="timer"></h4> -->
    <!-- <h3>Map pool:</h3> -->
    <!-- <h5>Dragon War - Darkest Hour - Freaks</h5> -->
    <div class="six offset-by-three col">
        <h6>Tournament duration: 1st - 31st of every month</h6>
        <h6>Every week few Workshop maps are added to ranked pool. They are picked based on in-game upvotes or playtime.
            Every mapper gets 1 point in Mapping League for every map added.
        </h6>
        <br><br>
        <h3>Total Prizing:</h3>
        <span id="totalPrize">Loading...</span>
        <br><br><br>
    </div>
    <!-- <h3>Results:</h3> -->
    <!-- <p>The best players across all leaderboards, updated every 10 mins.</p>  -->
</div>

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/hmac-sha256.js"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/hmac-sha256.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/hmac-sha256.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/enc-base64.min.js"></script>
<script type="text/javascript">

    // function shuffleArray(array) {
    //     for (let i = array.length - 1; i > 0; i--) {
    //         const j = Math.floor(Math.random() * (i + 1));
    //         [array[i], array[j]] = [array[j], array[i]];
    //     }
    // }
    async function main()
    {
        const settings = {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            }
        };
        const fetchResponse = await fetch(`https://api2.beataim.com/Main/GetEvents`, settings);
        const events = (await fetchResponse.json()).events;
        
        let date;
        for(var i = 0; i < events.length; i++)
        {
            if(events[i].title == 'Streamers League Results')
            {
                date = events[i].date;
                break;
            }
        }
        console.log(date);
        SetTimer();

        var t = "U2FsdGVkX18n+Uz1uB97JU15Va5bZASl6kXVcIyD6S8oEx3ANg6ywsCcW10y0iDMp0VM1RIB2p7gHzGGW0m+9QYdpBZpuo4RTWcM0PAVypo=";
        var div = document.createElement("div");
        div.className = "row text-center eight offset-by-two col";

        let htmlString = '';

        const tournamentsList = await (await fetch("game/tournamentsList.json")).json();
        await AddWinners(tournamentsList);
        AddRules();

        div.insertAdjacentHTML('beforeend', '<br><br><br><a href="https://discord.gg/suKsKjfgyc" target="_blank" ><h4>Previous tournaments</h4></a>');
        // div.insertAdjacentHTML('beforeend', '<br><br><br><h4>Previous tournaments:</h4>');
        // div.insertAdjacentHTML('beforeend', '<a href="https://cdn.discordapp.com/attachments/595011119790161920/694668016109224067/859ace597e72b606381310ce0cd5dd34.png" target="_blank" >Monthly League March Test</a><br>');
        // div.insertAdjacentHTML('beforeend', '<a href="tournamentsArchive/weekly1" >Weekly #1</a>');

        document.getElementsByClassName("content")[0].appendChild(div);


        function SetTimer()
        {
            var countDownDate;
            var today = new Date();
            // var today = new Date('April 30, 2020 22:00:00 GMT-01:00');
            // var today = new Date('May 1, 2020 00:00:00 GMT+01:00');
            // var today = new Date('April 30, 2020 24:00:00 GMT-01:00');
            // var today = new Date('May 1, 2020 02:00:00 GMT+01:00');

            // var startDay = 1;
            // var endDay = 17;
            // var prefix;
            // if (today.getUTCDate() >= startDay && today.getUTCDate() < endDay)
            // {
            //     prefix = "Ends in: ";
            //     var countDownDate = Date.UTC(today.getUTCFullYear(), today.getUTCMonth(), endDay);
            // }
            // else
            // {
            //     prefix = "Starts in: ";
            //     var countDownDate = Date.UTC(today.getUTCFullYear(), today.getUTCMonth() + 1, startDay);
            // }


            // var startDay = 21;
            var prefix;
            prefix = "Ends in: ";
            // if (today.getUTCDate() >= startDay)//   && today.getMonth() > 2)
            // {
            //     // prefix = "Maps Submissions phase ends in: ";
            //     // var lastDayOfMonth = Date.UTC(today.getUTCFullYear(), today.getUTCMonth() + 1, 1);
            //     var twDayOfNextMonth2 = Date.UTC(today.getUTCFullYear(), today.getUTCMonth() + 1, startDay);
            //     countDownDate = twDayOfNextMonth2;
            // }
            // else
            // {
            // prefix = "Voting phase ends in: ";
            var twDayOfNextMonth = Date.UTC(today.getUTCFullYear(), today.getUTCMonth() + 1, 1);
            countDownDate = twDayOfNextMonth;
            // }

            // var countDownDate = new Date(tournamentsList.tournaments[tournamentsList.tournaments.length - 1].end).getTime();
            // var countDownDate = new  Date(tournamentsList.tournaments[0].end).getTime();
            // var countDownDate = new Date("Mon 11, 2019 12:00:00").getTime();

            var timerElement = document.getElementById("timer");
            if (timerElement)
            {
                var x = setInterval(UpdateTime, 1000);
                UpdateTime();
                function UpdateTime()
                {
                    var now = new Date().getTime();
                    var distance = countDownDate - now;
                    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    var seconds = Math.floor((distance % (1000 * 60)) / 1000);


                    // if (distance < 0)
                    // {
                    //     clearInterval(x);
                    //     timerElement.innerHTML = "Ended";
                    // }
                    // else
                    timerElement.innerHTML = prefix + days + "d " + hours + "h " + minutes + "m " + seconds + "s ";
                }
            }
        }

        async function AddWinners(tList)
        {
            div.insertAdjacentHTML('beforeend', '<h3>Ranking:</h3>');

            try
            {
                htmlString += '<table class="expand hoverable" id="table-example"> \
            <thead>\
              <tr>\
                <th>Place</th>\
                <th>Player</th>\
                <th>Prize</th>\
                <th>Points</th>\
                <th>Trend</th>\
              </tr>\
            </thead>\
            <tbody>';
                // <th>Score</th>\
                // <th>Prize</th>\
                // <th>Country</th>\

                // topPlayers = await response.json();
                // topPlayers = JSON.parse('[["XVoIR",3000],["Brumor",2951,"https://youtu.be/PbpKACOuSXo?t=1552"],["HoundFPS",2929],["jwun",2902],["FallenAng3L",2885],["meeko",2862],["Naoki",2856],["Nayllo",2820],["XensKittyCat",2771],["autumns",2745]]');
                // var winnersJson = JSON.parse(tournamentsList.tournaments[1].winnersJson);
                // var winnersJsonString = await (await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vTovzEFnaeJtKjxwdWwQQwgxbPTH_9_UnLbxWTnJruUnSAKFGBm9bQtbZw87EYCLH7FsbdVAVBMAxRH/pub?output=tsv")).text();
                // var winnersJsonString = `Name	SteamId	Country	Score
                // Leviathan	76561198084022633	US	468
                // Pyroxia	76561198133585151	TR	466
                // Sosik	76561198093456452	US	465
                // GlycerinDawn	76561198864176237	US	459
                // Nayllo	76561198165098634		457
                // Merryeliot[FR]	76561198106672504		447
                // Kamyker	76561198053936045	PL	445
                // ImSorry	76561198141855723		411
                // FallenMystery15	76561198844204184		396
                // KNIGHT	76561198985195690		395
                // eck	76561198097149970	US	379
                // djmon007	76561198119137613	US	377
                // Rancid Ranch	76561198434726804	US	368
                // Syssnow	76561198219523784	FR	363`;
                var savedId = "MappingLeague";
                async function Dl()
                {
                    var leagueSaved = {};
                    leagueSaved.Date = new Date();

                    var fetched = await fetch(GetCdnLinkCacheBustedToOneMinute("mappingLeague.tsv"));
                    leagueSaved.Value = await fetched.text();

                    fetched = await fetch(GetCdnLinkCacheBustedToOneMinute("mappingLeaguePrizes.json"));
                    leagueSaved.Prizing = JSON.parse(await fetched.text());

                    window.localStorage.setItem(savedId, JSON.stringify(leagueSaved));
                    return leagueSaved;


                    // var accessData = GrtAzureAccessData("MappingLeagueTsv", "Leaderboard");
                    // var fetched = await fetch(accessData.Url, { headers: accessData.Headers });
                    // var winnersJsonString = await fetched.text();
                    // var leagueSaved = JSON.parse(winnersJsonString);
                    // leagueSaved.Date = new Date();
                    // window.localStorage.setItem(savedId, JSON.stringify(leagueSaved));
                    // return leagueSaved;
                }

                // window.localStorage.removeItem(savedId);
                var leagueSaved = JSON.parse(window.localStorage.getItem(savedId));
                if (!leagueSaved
                    || !leagueSaved.hasOwnProperty("Value")
                    || !leagueSaved.hasOwnProperty("Date"))
                    leagueSaved = await Dl();
                else if (leagueSaved.hasOwnProperty("Date")
                    && new Date().getTime() > new Date(leagueSaved.Date).getTime() + 1 * 60000)
                    leagueSaved = await Dl();


                document.getElementById("totalPrize").textContent = leagueSaved.Prizing.TotalPrize;
                // for (var key in accessData.Headers)
                // {
                //     var value = accessData.Headers[key];

                //     console.log(key + ": " + value);
                // }
                // var winnersJsonString = await (await fetch(CryptoJS.AES.decrypt(t, 'https://beataim.com/leaderboard.json').toString(CryptoJS.enc.Utf8))).text();
                // localStorage.setItem('myCat', 'Tom');
                // var winnersJsonString = await (await fetch("http://localhost:7071/api/GetMonthlyLeague")).text();
                // console.log(winnersJsonString);
                var data = d3.tsvParse(leagueSaved.Value);
                for (let i = 0; i < data.length || i < leagueSaved.Prizing.Prizes.length; i++)
                {
                    var place;
                    switch (i)
                    {
                        case 0:
                            place = "ü•á";
                            break;
                        case 1:
                            place = "ü•à";
                            break;
                        case 2:
                            place = "ü•â";
                            break;
                        default:
                            place = i + 1;
                    }

                    htmlString += `<tr><td>${(place)}</td>` +
                        `<td>${(data[i]?.MapperName || '-')}</a></td>` +
                        // `<td><a href="https://steamcommunity.com/sharedfiles/filedetails/?id=${(data[i].MapId || '-')}"><img src="${(data[i].ImgUrl || 'https://beataim.com/favicon.ico')}" alt="" width="26" height="26" style="vertical-align:middle">&nbsp;&nbsp;${(data[i].MapTitle || '-')}</a></td>` +
                        `<td>${(leagueSaved.Prizing.Prizes[i] || "")}</td>` +
                        `<td>${(data[i]?.Points || "")} üéº</td>` +
                        `<td>${(data[i]?.Arrow || "")}</td>`

                    // var country = data[i].Country
                    // if (country)
                    // {
                    //     if (country == "us")
                    //         htmlString += `<td><i class="em em-${data[i].Country.toLowerCase()}" aria-role="presentation"></i></td></tr>`
                    //     else
                    //         htmlString += `<td><i class="em em-flag-${data[i].Country.toLowerCase()}" aria-role="presentation"></i></td></tr>`
                    // }
                    // else
                    //     htmlString += `<td></td></tr>`
                    htmlString += `</tr>`

                }

            } catch (error)
            {
                htmlString += 'error :(';
                console.log(error)
            }
            htmlString += '</tbody>\
          </table>';
            div.insertAdjacentHTML('beforeend', htmlString);
        }

        function AddRules()
        {
            div.insertAdjacentHTML('beforeend', '<br><h3>Rules:</h3>');
            div.insertAdjacentHTML('beforeend', `<p>Valid paypal account is required to redeem the winnings.</p>`);
            div.insertAdjacentHTML('beforeend', `<p>Player has to fill out google form posted in monthly Steam News.</p>`);
            // div.insertAdjacentHTML('beforeend', `<p>Scoring may change during tournament, for now it's set to ranked by trending since month start.</p>`);
        }
    }
    main();




</script>

</div>
<div class="footer " style="font-size: 10px">
    <div class="row text-center">
        <div class=" six col ">
            <span>Created using Meshki by <a href=" https://github.com/Borderliner" target="_blank">Borderliner </a>
            </span> </div>
        <div class="six col">
            <span>Few icons by <a href="http://www.freepik.com/" target="_blank">Freepik</a> from <a
                    href="http://www.flaticon.com/" target="_blank">www.flaticon.com </a></span>
        </div>
    </div>
</div>

<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js"></script>
<script type="text/javascript">
  // var percent_update = function () {
  //   document.getElementById("percent_value").innerHTML = this.value;
  //   console.log(this.value);
  // };

  // document.getElementById("percent").onchange = percent_update;
  // document.getElementById("percent").oninput = percent_update;

  var clipboard = new Clipboard('.clipboard-btn');
  clipboard.on('success', function (e) {
    var classArray = e.trigger.className.split(' ');
    classArray.splice(classArray.indexOf('blue'), 1);
    classArray.push('green');
    e.trigger.className = classArray.join(' ');
    e.trigger.innerHTML = '<i class="fa fa-check" aria-hidden="true"></i> Copied';

    window.setTimeout(function () {
      var classArray = e.trigger.className.split(' ');
      classArray.splice(classArray.indexOf('green'), 1);
      classArray.push('blue');
      e.trigger.className = classArray.join(' ');
      e.trigger.innerHTML = '<i class="fa fa-clipboard" aria-hidden="true"></i>';
    }, 2000);
  });

  clipboard.on('error', function (e) {
    var classArray = e.trigger.className.split(' ');
    classArray.splice(classArray.indexOf('blue'), 1);
    classArray.push('red');
    e.trigger.className = classArray.join(' ');
    e.trigger.innerHTML = '<i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Error';

    window.setTimeout(function () {
      var classArray = e.trigger.className.split(' ');
      classArray.splice(classArray.indexOf('red'), 1);
      classArray.push('blue');
      e.trigger.className = classArray.join(' ');
      e.trigger.innerHTML = '<i class="fa fa-clipboard" aria-hidden="true"></i>';
    }, 2000);
  });
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.6.0/prism.min.js"></script>
</body>

</html>